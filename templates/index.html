<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pornography Infrastructure Mapping - Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç AI Pornography Infrastructure Mapping</h1>
            <p class="subtitle">Visualizing infrastructure relationships behind domains</p>
        </header>
        
        <!-- Summary Section -->
        <div class="summary-section" id="summary-section">
            <h2>Summary & Outliers</h2>
            <div class="summary-content" id="summary-content">
                <div class="loading">Loading analytics...</div>
            </div>
        </div>
        
        <!-- View Toggle -->
        <div class="view-toggle">
            <button class="view-btn active" data-view="graph" id="graph-view-btn">
                Visualization
            </button>
            <button class="view-btn" data-view="table" id="table-view-btn">
                Table
            </button>
            <button class="view-btn" data-view="analysis" id="analysis-view-btn">
                Analysis
            </button>
            <button class="view-btn" data-view="about" id="about-view-btn">
                About
            </button>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <div class="stats" id="stats">
                <span>Loading statistics...</span>
            </div>
            <div class="buttons">
                <button id="refresh-btn" class="btn btn-primary">Refresh</button>
                <button id="reset-zoom-btn" class="btn btn-secondary" style="display: none;">Reset Zoom</button>
                <button id="export-btn" class="btn btn-success">Export Data</button>
            </div>
        </div>
        
        <!-- Graph View -->
        <div class="view-container" id="graph-view">
            <div class="graph-controls">
                <div class="search-box">
                    <input type="text" id="graph-search" placeholder="üîç Filter by domain, CDN, host, CMS, registrar..." class="search-input">
                </div>
                <div class="graph-filters">
                    <span class="filter-label">Show service types:</span>
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filter-host" checked>
                        <span>Hosts</span>
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filter-cdn" checked>
                        <span>CDNs</span>
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filter-cms" checked>
                        <span>CMS</span>
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filter-registrar" checked>
                        <span>Registrars</span>
                    </label>
                </div>
                <div class="graph-info">
                    <span id="graph-count">0 nodes</span>
                </div>
            </div>
            <div class="graph-container">
                <svg id="graph-svg"></svg>
                <div id="tooltip" class="tooltip"></div>
            </div>
            
            <!-- Node Detail Modal -->
            <div id="node-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="modal-close">&times;</span>
                    <div id="modal-body"></div>
                </div>
            </div>
            
            <div class="legend">
                <h3>Node Types</h3>
                <div class="legend-section">
                    <h4>Domains (URLs)</h4>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-color domain"></span>
                            <span><strong>Domain</strong> - The websites being analyzed</span>
                        </div>
                    </div>
                </div>
                <div class="legend-section">
                    <h4>Services (Top 20 by frequency)</h4>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-color host"></span>
                            <span>Hosting Provider</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color cdn"></span>
                            <span>CDN</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color cms"></span>
                            <span>CMS</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color registrar"></span>
                            <span>Registrar</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Table View -->
        <div class="view-container" id="table-view" style="display: none;">
            <div class="table-controls">
                <div class="search-box">
                    <input type="text" id="table-search" placeholder="üîç Search domains, CMS, CDN, country..." class="search-input">
                </div>
                <div class="filter-box">
                    <select id="filter-column" class="filter-select">
                        <option value="">All Columns</option>
                        <option value="domain">Domain</option>
                        <option value="ip_address">IP Address</option>
                        <option value="isp">ISP</option>
                        <option value="host_name">Host</option>
                        <option value="cms">CMS</option>
                        <option value="cdn">CDN</option>
                        <option value="web_server">Web Server</option>
                        <option value="payment_processor">Payment Processor</option>
                        <option value="registrar">Registrar</option>
                    </select>
                </div>
                <div class="column-controls">
                    <button id="show-all-btn" class="btn btn-secondary">Show All Columns</button>
                    <button id="column-toggle-btn" class="btn btn-secondary">üìã Columns</button>
                    <div id="column-menu" class="column-menu" style="display: none;">
                        <div class="column-menu-header">Toggle Columns</div>
                        <div id="column-checkboxes"></div>
                        <div class="column-menu-footer">
                            <button id="save-columns-btn" class="btn btn-success">üíæ Save</button>
                            <button id="reset-columns-btn" class="btn btn-secondary">Reset</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="table-wrapper">
                <table id="domains-table" class="data-table">
                    <thead>
                        <tr>
                            <th class="row-number">#</th>
                            <th class="sortable col-domain" data-column="domain" data-col="domain">Domain ‚Üï</th>
                            <th class="sortable col-isp" data-column="isp" data-col="isp">ISP ‚Üï</th>
                            <th class="sortable col-host" data-column="host_name" data-col="host_name">Host ‚Üï</th>
                            <th class="sortable col-cms" data-column="cms" data-col="cms">CMS ‚Üï</th>
                            <th class="sortable col-cdn" data-column="cdn" data-col="cdn">CDN ‚Üï</th>
                            <th class="sortable col-registrar" data-column="registrar" data-col="registrar">Registrar ‚Üï</th>
                            <th class="sortable col-created" data-column="creation_date" data-col="creation_date">Created ‚Üï</th>
                            <th class="col-frameworks" data-col="frameworks">Frameworks</th>
                            <th class="sortable col-ip hidden-col" data-column="ip_address" data-col="ip_address">IP Address ‚Üï</th>
                            <th class="sortable col-country hidden-col" data-column="country" data-col="country">Country ‚Üï</th>
                            <th class="sortable col-asn hidden-col" data-column="asn" data-col="asn">ASN ‚Üï</th>
                            <th class="sortable col-webserver hidden-col" data-column="web_server" data-col="web_server">Web Server ‚Üï</th>
                            <th class="sortable col-payment hidden-col" data-column="payment_processor" data-col="payment_processor">Payment ‚Üï</th>
                            <th class="sortable col-expires hidden-col" data-column="expiration_date" data-col="expiration_date">Expires ‚Üï</th>
                            <th class="col-analytics hidden-col" data-col="analytics">Analytics</th>
                            <th class="col-languages hidden-col" data-col="languages">Languages</th>
                            <th class="col-ipv4 hidden-col" data-col="ip_addresses">IPs (IPv4)</th>
                            <th class="col-ipv6 hidden-col" data-col="ipv6_addresses">IPv6</th>
                            <th class="col-nameservers hidden-col" data-col="name_servers">Name Servers</th>
                            <th class="col-mx hidden-col" data-col="mx_records">MX Records</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr><td colspan="21" class="loading">Loading data...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="table-info">
                <span id="table-count">0 domains</span>
            </div>
        </div>
        
        <!-- Analysis View -->
        <div class="view-container" id="analysis-view" style="display: none;">
            <div class="analysis-section">
                <h2>üîç Analysis and Review</h2>
                <div class="analysis-content" id="analysis-content">
                    <div class="loading">Loading AI analysis...</div>
                </div>
            </div>
        </div>
        
        <!-- About View -->
        <div class="view-container" id="about-view" style="display: none;">
            <div class="about-section">
                <h2>‚ÑπÔ∏è About This Project</h2>
                
                <div class="about-content">
                    <section class="about-section-block">
                        <h3>üéØ Project Goals</h3>
                        <p>
                            This tool maps and visualizes the infrastructure (hosts, CDNs, CMS, payment processors, domains) 
                            behind AI-generated non-consensual intimate imagery (NCII) websites. The goal is to help NGOs, 
                            researchers, and law enforcement track infrastructure patterns and identify service providers 
                            that enable these harmful sites.
                        </p>
                    </section>
                    
                    <section class="about-section-block">
                        <h3>üîç What This Tool Does</h3>
                        <ul>
                            <li><strong>Domain Enrichment:</strong> Collects metadata about domains including hosting providers, CDNs, registrars, and technology stacks</li>
                            <li><strong>Infrastructure Mapping:</strong> Visualizes relationships between domains and service providers in an interactive graph</li>
                            <li><strong>Pattern Analysis:</strong> Identifies common infrastructure providers and service concentrations</li>
                            <li><strong>Data Export:</strong> Exports enriched datasets for further analysis and reporting</li>
                        </ul>
                    </section>
                    
                    <section class="about-section-block">
                        <h3>üõ°Ô∏è Ethics & Safety</h3>
                        <ul>
                            <li><strong>No Content Collection:</strong> This tool only collects metadata (IPs, hosting info, tech stack) - no actual website content</li>
                            <li><strong>Anonymized Data:</strong> Personal information is not stored or collected</li>
                            <li><strong>Compliance:</strong> Designed to comply with data privacy and NCII laws</li>
                            <li><strong>Secure Access:</strong> API keys and database credentials are stored securely</li>
                        </ul>
                    </section>
                    
                    <section class="about-section-block">
                        <h3>üìä Key Features</h3>
                        <ul>
                            <li><strong>Interactive Graph Visualization:</strong> Explore relationships between domains and service providers</li>
                            <li><strong>Comprehensive Data Table:</strong> View detailed information about each domain with filtering and sorting</li>
                            <li><strong>AI-Powered Analysis:</strong> Automated identification of high-impact service providers and actionable recommendations</li>
                            <li><strong>Export Capabilities:</strong> Download data in CSV or JSON formats for reporting and analysis</li>
                        </ul>
                    </section>
                    
                    <section class="about-section-block">
                        <h3>üéØ Use Cases</h3>
                        <ul>
                            <li><strong>NGOs:</strong> Track infrastructure patterns to identify providers enabling harmful content</li>
                            <li><strong>Law Enforcement:</strong> Gather evidence and identify service providers for legal action</li>
                            <li><strong>Researchers:</strong> Study infrastructure patterns and concentration of services</li>
                            <li><strong>Advocacy Groups:</strong> Contact service providers to request domain removal</li>
                        </ul>
                    </section>
                    
                    <section class="about-section-block">
                        <h3>üîß Technical Details</h3>
                        <p>
                            This tool uses free APIs and open-source technologies to enrich domain data:
                        </p>
                        <ul>
                            <li><strong>Data Storage:</strong> Neo4j (graph database) and PostgreSQL (relational database)</li>
                            <li><strong>Visualization:</strong> D3.js for interactive graph visualization</li>
                            <li><strong>Enrichment:</strong> WHOIS, DNS, IP geolocation, CMS detection, and technology stack analysis</li>
                            <li><strong>Web Framework:</strong> Flask for the web interface</li>
                        </ul>
                    </section>
                    
                    <section class="about-section-block">
                        <h3>üìù Important Principle</h3>
                        <p class="highlight-box">
                            <strong>Service providers (CDNs, hosts, ISPs) are being paid to enable these sites.</strong> 
                            They must be held accountable, regardless of whether they're acting as intermediaries. 
                            This tool helps identify these providers and provides actionable recommendations for 
                            contacting them to request domain removal.
                        </p>
                    </section>
                </div>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/visualization.js') }}"></script>
</body>
</html>
